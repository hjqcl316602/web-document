# 书写优化

## 1.善用函数的写法

;(function() {
// 主业务代码
})();
高级一点的
;(function(win, doc, \$, undefined) {
// 主业务代码
})(window, document, jQuery);
好处：JavaScript 中能形成作用域的有函数的调用、with 语句和全局作用域

## 2.不要定义全局变量

当一个变量被定义在全局作用域中，默认情况下 JavaScript 引擎就不会将其回收销毁。如此该变量就会一直存在于老生代堆内存中，直到页面被关闭。那么我们就一直遵循一个原则：绝对不要使用全局变量。虽然全局变量在开发中确实很省事，但是全局变量所导致的问题远比其所带来的方便更严重 - 使变量不易被回收； - 多人协作时容易产生混淆； - 在作用域链中容易被干扰

## 3. 手工解除变量引用

如果在业务代码中，一个变量已经确切是不再需要了，那么就可以手工解除变量引用，以使其被回收
var data = { /_ some big data _/ };
// blah blah blah
data = null;

## 4.善用回调函数

- 如果传入的参数是基础类型（如字符串、数值），回调函数中传入的形参就会是复制值，业务代码使用完毕以后，更容易被回收；
- 通过回调，我们除了可以完成同步的请求外，还可以用在异步编程中，这也就是现在非常流行的一种编写风格；
- 回调函数自身通常也是临时的匿名函数，一旦请求函数执行完毕，回调函数自身的引用就会被解除，自身也得到回收

```js
function getData(callback) {
  var data = "some big data";
  callback(null, data);
}
getData(function(err, data) {
  console.log(data);
});
function testCallBack(num, callback) {
  var log = [];
  for (var n = 1; n < num + 1; n++) {
    log[n] = "";
    for (var l = 0; l < num - n; l++) {
      log[n] += " ";
    }
    for (var m = 0; m < 2 * n - 1; m++) {
      log[n] += "*";
    }
    console.log(log[n]);
  }
  callback();
}
testCallBack(2000, function() {
  alert("执行完成");
});
```

## 5.内存不是缓存

缓存在业务开发中的作用举足轻重，可以减轻时空资源的负担。但需要注意的是，不要轻易将内存当作缓存使用。内存对于任何程序开发来说都是寸土寸金的东西，如果不是很重要的资源，请不要直接放在内存中，或者制定过期机制，自动销毁过期缓存

## 6. 让代码简洁：一些简略的表达方式也会产生很好的优化

eg：x=x+1;在不影响功能的情况下可以简写为 x++;

## 7. 变量名方法名尽量在不影响语意的情况下简单。（可以选择首字母命名）

eg：定义数组的长度可以取名为：ArrLen 而不需要取为 ArrayLength。

## 8. 关于 JS 的循环，循环是一种常用的流程控制。

JS 提供了三种循环：for(;;)、while()、for(in)。在这三种循环中 for(in)的效率最差，因为它需要查询 Hash 键，因此应尽量少用 for(in)循环，for(;;)、while()循环的性能基本持平。当然，推荐使用 for 循环，如果循环变量递增或递减，不要单独对循环变量赋值，而应该使用嵌套的++或–运算符。

## 9. 如果需要遍历数组，应该先缓存数组长度，将数组长度放入局部变量中，避免多次查询数组长度。

因为我们常常要根据字符串、数组的长度进行循环，而通常这个长度是不变的，比如每次查询 a.length，就要额外进行一个操作，而预先把 var len=a.length，则就少了一次查询。

## 10.尽量选用局部变量而不是全局变量。

局部变量的访问速度要比全局变量的访问速度更快，因为全局变量其实是 window 对象的成员，而局部变量是放在函数的栈里的。

## 11. 尽量少使用 eval。

每次使用 eval 需要消耗大量时间，这时候使用 JS 所支持的闭包可以实现函数模板。

## 12. 减少对象查找

因为 JavaScript 的解释性，所以 a.b.c.d.e，需要进行至少 4 次查询操作，先检查 a 再检查 a 中的 b，再检查 b 中的 c，如此往下。所以如果这样的表达式重复出现，只要可能，应该尽量少出现这样的表达式，可以利用局部变量，把它放入一个临时的地方进行查询。

## 13. 字符串连接

如果是追加字符串，最好使用 s+=anotherStr 操作，而不是要使用 s=s+anotherStr。
如果要连接多个字符串，应该少使用+=，如 s+=a;s+=b;s+=c;应该写成 s+=a + b + c；
而如果是收集字符串，比如多次对同一个字符串进行+=操作的话，最好使用一个缓存。怎么用呢？使用 JavaScript 数组来收集，最后使用 join 方法连接起来，如下
var buf = new Array();for(var i = 0; i < 100; i++){ buf.push(i.toString());}var all = buf.join("");

## 14. 类型转换

- 把数字转换成字符串，应用"" + 1，虽然看起来比较丑一点，但事实上这个效率是最高的，性能上来说：("" +) > String() > .toString() > new String()
  尽量使用编译时就能使用的内部操作要比运行时使用的用户操作要快。
  String()属于内部函数，所以速度很快，而.toString()要查询原型中的函数，所以速度逊色一些，new String()用于返回一个精确的副本。
- 浮点数转换成整型，这个更容易出错，很多人喜欢使用 parseInt()，其实 parseInt()是用于将字符串转换成数字，而不是浮点数和整型之间的转换，我们应该使用 Math.floor()或者 Math.round()。Math 是内部对象，所以 Math.floor()其实并没有多少查询方法和调用的时间，速度是最快的。
- 对于自定义的对象，如果定义了 toString()方法来进行类型转换的话，推荐显式调用 toString()，因为内部的操作在尝试所有可能性之后，会尝试对象的 toString()方法尝试能否转化为 String，所以直接调用这个方法效率会更高

## 15. 尽量作用 JSON 格式来创建对象，而不是 var obj=new Object()方法。

因为前者是直接复制，而后者需要调用构造器，因而前者的性能更好。

## 16. 当需要使用数组时，也尽量使用 JSON 格式的语法，

使用 JSON 格式的语法即直接使用如下语法定义数组：[parrm,param,param...],而不是采用 new Array(parrm,param,param...)这种语法。因为使用 JSON 格式的语法是引擎直接解释的。而后者则需要调用 Array 的构造器。

## 17. 对字符串进行循环操作，例如替换、查找，就使用正则表达式。

因为 JS 的循环速度比较慢，而正则表达式的操作是用 C 写成的 API，性能比较好。

## 18. 插入 HTML

很多人喜欢在 JavaScript 中使用 document.write 来给页面生成内容。事实上这样的效率较低，如果需要直接插入 HTML，可以找一个容器元素，比如指定一个 div 或者 span，并设置他们的 innerHTML 来将自己的 HTML 代码插入到页面中。

## 19. 对象查询

使用[“”]查询要比.items()更快

## 20. 定时器

如果针对的是不断运行的代码，不应该使用 setTimeout，而应该是用 setInterval。setTimeout 每次要重新设置一个定时器。

## 21. 尽量减少 DOM 调用

在 Web 开发中，JavaScript 的一个很重要的作用就是对 DOM 进行操作。可是对 DOM 的操作是非常昂贵的，因为这会导致浏览器执行回流 （reflow）操作。我们应该尽可能的减少 DOM 操作。

```

```
